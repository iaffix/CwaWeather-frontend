<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éº¥å¡Šæ°£è±¡å°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Minecraft ç¶“å…¸è‰²ç¥¨ */
            --mc-dirt-bg: #291912;
            --mc-dirt-fg: #4A3322;
            --mc-grass: #5E9D34;
            --mc-ui-gray: #C6C6C6;
            --mc-ui-dark: #373737;
            --mc-ui-light: #FFFFFF;
            --mc-shadow: #212121;
            --mc-text: #3F3F3F;
            --mc-green-text: #3E5E26;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            /* è®“æ‰€æœ‰å­—é«”éƒ½æœ‰åƒç´ æ„Ÿ */
            font-family: 'DotGothic16', sans-serif;
        }

        body {
            background-color: var(--mc-dirt-bg);
            /* æ¨¡æ“¬æ³¥åœŸèƒŒæ™¯ç´‹ç† */
            background-image:
                linear-gradient(45deg, var(--mc-dirt-fg) 25%, transparent 25%, transparent 75%, var(--mc-dirt-fg) 75%, var(--mc-dirt-fg)),
                linear-gradient(45deg, var(--mc-dirt-fg) 25%, transparent 25%, transparent 75%, var(--mc-dirt-fg) 75%, var(--mc-dirt-fg));
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            min-height: 100vh;
            color: var(--mc-text);
            padding-bottom: 20px;
            image-rendering: pixelated;
        }

        /* éº¥å¡Šé¢¨æ ¼çš„æŒ‰éˆ•/é¢æ¿æ¨£å¼ (Bevel Effect) */
        .mc-box {
            background-color: var(--mc-ui-gray);
            border-top: 4px solid var(--mc-ui-light);
            border-left: 4px solid var(--mc-ui-light);
            border-right: 4px solid var(--mc-ui-dark);
            border-bottom: 4px solid var(--mc-ui-dark);
            /* çµ•å°ä¸ä½¿ç”¨åœ“è§’ */
            border-radius: 0;
            box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.5);
            position: relative;
        }

        /* é ‚éƒ¨ç‹€æ…‹åˆ— - æ¨¡ä»¿ Boss Bar æˆ– Debug è³‡è¨Š */
        .status-bar {
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.6);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            text-shadow: 2px 2px 0 #000;
            border-bottom: 4px solid rgba(0, 0, 0, 0.4);
        }

        .location-text {
            font-size: 1.5rem;
            letter-spacing: 2px;
        }

        .update-text {
            font-size: 0.9rem;
            color: #AAAAAA;
        }

        .container {
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        /* === æ ¸å¿ƒï¼šä»Šæ—¥ç„¦é»å¡ç‰‡ (ç‰©å“æ¬„é¢¨æ ¼) === */
        .hero-card {
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .inventory-label {
            position: absolute;
            top: -15px;
            left: 10px;
            background: #8B8B8B;
            color: white;
            padding: 2px 10px;
            border: 2px solid #000;
            font-size: 1rem;
            text-shadow: 2px 2px 0 #000;
        }

        .hero-temp-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
            background: #8B8B8B;
            /* æ·±ç°è‰²æ§½ä½èƒŒæ™¯ */
            padding: 15px;
            box-shadow: inset 4px 4px 0 #373737, inset -2px -2px 0 #FFF;
        }

        .hero-icon {
            font-size: 4rem;
            /* åƒç´ é¢¨æ ¼çš„è·³å‹• */
            animation: bobbing 2s infinite steps(2);
        }

        @keyframes bobbing {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-8px);
            }
        }

        .hero-temp {
            font-size: 4rem;
            color: white;
            text-shadow: 3px 3px 0 #000;
            line-height: 1;
        }

        .hero-desc {
            font-size: 1.8rem;
            color: #3F3F3F;
            margin-bottom: 20px;
            font-weight: bold;
            text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.5);
        }

        /* === è£å‚™å»ºè­°å€ (æ ¼å­ç‹€) === */
        .advice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .slot-item {
            background: #8B8B8B;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: inset 3px 3px 0 #373737, inset -2px -2px 0 #FFF;
            position: relative;
        }

        /* æ»‘é¼ æ‡¸åœæ•ˆæœ (é¸ä¸­æ¡†) */
        .slot-item:active {
            background: #A0A0A0;
            outline: 4px solid white;
            z-index: 10;
        }

        .advice-icon {
            font-size: 2.5rem;
            margin-bottom: 5px;
            filter: drop-shadow(2px 2px 0 rgba(0, 0, 0, 0.5));
        }

        .advice-text {
            font-size: 1.1rem;
            color: white;
            text-shadow: 2px 2px 0 #000;
            margin-top: 5px;
        }

        .tooltip {
            font-size: 0.8rem;
            color: #DDD;
            margin-top: 2px;
            text-shadow: 1px 1px 0 #000;
        }

        /* === ç¨å¾Œé å ±ï¼šç‰©å“å¿«æ·æ¬„ (Hotbar) é¢¨æ ¼ === */
        .section-title {
            font-size: 1.2rem;
            color: white;
            margin-bottom: 10px;
            text-shadow: 2px 2px 0 #000;
            border-left: 5px solid var(--mc-grass);
            padding-left: 10px;
            background: rgba(0, 0, 0, 0.3);
        }

        .hotbar-container {
            display: flex;
            overflow-x: auto;
            gap: 5px;
            padding: 10px 0;
            scrollbar-width: none;
        }

        .hotbar-slot {
            min-width: 100px;
            background: rgba(0, 0, 0, 0.4);
            /* åŠé€æ˜é»‘åº• */
            border: 3px solid #666;
            /* ç°¡å–®çš„é‚Šæ¡† */
            padding: 10px;
            text-align: center;
            flex-shrink: 0;
            position: relative;
        }

        /* é¸ä¸­çš„æ ¼å­æ•ˆæœ */
        .hotbar-slot:first-child {
            border: 3px solid white;
            background: rgba(0, 0, 0, 0.6);
        }

        .mini-time {
            color: #FFFF55;
            /* Minecraft é»ƒå­— */
            font-size: 0.9rem;
            text-shadow: 1px 1px 0 #3F3F00;
            margin-bottom: 5px;
        }

        .mini-icon {
            font-size: 2.5rem;
            margin: 5px 0;
        }

        .mini-temp {
            font-size: 1rem;
            color: white;
            text-shadow: 1px 1px 0 #000;
        }

        /* Loading ç•«é¢ - æ¨¡ä»¿ Mojang æˆ– ç”Ÿæˆåœ°å½¢ */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #231106;
            /* æ³¥åœŸæ·±è‰² */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
            /* ç¶“å…¸çš„æš—è§’æ•ˆæœ */
            box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.9);
        }

        .loading-bar-bg {
            width: 200px;
            height: 10px;
            border: 2px solid white;
            margin-top: 20px;
            padding: 2px;
        }

        .loading-bar-fill {
            height: 100%;
            width: 0%;
            background-color: #5E9D34;
            /* ç¶ è‰²é€²åº¦æ¢ */
            animation: load 1.5s forwards;
        }

        @keyframes load {
            0% {
                width: 0%;
            }

            20% {
                width: 10%;
            }

            50% {
                width: 40%;
            }

            80% {
                width: 80%;
            }

            100% {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <div id="loading" class="loading-screen">
        <h1 style="color: white; text-shadow: 3px 3px 0 #000; margin-bottom: 10px;">Generating World...</h1>
        <p style="color: #AAAAAA; font-size: 0.8rem;">æ­£åœ¨è¼‰å…¥å€å¡Š</p>
        <div class="loading-bar-bg">
            <div class="loading-bar-fill"></div>
        </div>
    </div>

    <div class="status-bar">
        <div class="location-text">åº§æ¨™: å°åŒ—</div>
        <div id="updateTime" class="update-text">Day 0</div>
    </div>

    <div class="container" id="mainContent" style="display: none;">

        <div id="heroCard">
        </div>

        <h3 class="section-title">æœªä¾†é æ¸¬</h3>
        <div class="hotbar-container" id="futureForecasts">
        </div>

    </div>

    <script>
        const API_URL = "https://weather-affix.zeabur.app/api/weather/taipei";

        function getWeatherIcon(weather) {
            // ç›¡é‡æ‰¾é¡ä¼¼ Minecraft ç‰©å“çš„ Emoji
            if (!weather) return "ğŸŒ¤ï¸";
            if (weather.includes("æ™´")) return "â˜€ï¸"; // æ—¥å…‰æ„Ÿæ¸¬å™¨?
            if (weather.includes("å¤šé›²")) return "ğŸŒ¥ï¸";
            if (weather.includes("é™°")) return "â˜ï¸";
            if (weather.includes("é›¨")) return "ğŸŒ§ï¸";
            if (weather.includes("é›·")) return "â›ˆï¸"; // å¬å–šé›·é›»
            return "ğŸŒ¤ï¸";
        }

        function getAdvice(rainProb, maxTemp) {
            // è½‰æ›æˆ Minecraft è¡“èª
            let rainIcon = "ğŸ›¡ï¸"; // ç›¾ç‰Œ
            let rainText = "å¤©æ°£æ™´æœ—";
            let rainTooltip = "è€ä¹…åº¦ 100%";

            if (parseInt(rainProb) > 30) {
                rainIcon = "ğŸ›¶"; // èˆ¹ (å› ç‚ºä¸‹é›¨æœƒæ·¹æ°´?) æˆ–è€…ä¸‰å‰æˆŸ
                rainText = "æ³¨æ„æ·‹æ¿•";
                rainTooltip = `é™é›¨æ©Ÿç‡ ${rainProb}%`;
            }

            let clothIcon = "ğŸ‘•";
            let clothText = "çš®é©è£å‚™";
            let clothTooltip = "é˜²ç¦¦åŠ› +1";

            if (parseInt(maxTemp) >= 28) {
                clothIcon = "ğŸ–"; // å¤ªç†±äº†ï¼Œéœ€è¦è£œçµ¦
                clothText = "æ³¨æ„å²©æ¼¿";
                clothTooltip = `æœ€é«˜æº« ${maxTemp}Â°`;
            } else if (parseInt(maxTemp) <= 20) {
                clothIcon = "ğŸ§¥"; // ç©¿å¤šé»
                clothText = "å°å¿ƒæµæµªè€…"; // é›ªåœ°çš„éª·é«
                clothTooltip = "é˜²æ­¢å‡å‚·";
            }

            return { rainIcon, rainText, rainTooltip, clothIcon, clothText, clothTooltip };
        }

        function getTimePeriod(startTime) {
            const hour = new Date(startTime).getHours();
            if (hour >= 6 && hour < 18) return "æ—¥";
            return "å¤œ";
        }

        function renderWeather(data) {
            const forecasts = data.forecasts;
            const current = forecasts[0];
            const others = forecasts.slice(1);

            const advice = getAdvice(current.rain, current.maxTemp);
            const avgTemp = Math.round((parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2);

            // 1. æ¸²æŸ“ Inventory Card (ä¸»ç•«é¢)
            document.getElementById('heroCard').innerHTML = `
                <div class="mc-box hero-card">
                    <div class="inventory-label">ç•¶å‰ç‰©å“æ¬„</div>
                    
                    <div class="hero-temp-container">
                        <div class="hero-icon">${getWeatherIcon(current.weather)}</div>
                        <div class="hero-temp">${avgTemp}Â°</div>
                    </div>
                    
                    <div class="hero-desc">${current.weather}</div>
                    
                    <div class="advice-grid">
                        <div class="slot-item">
                            <div class="advice-icon">${advice.rainIcon}</div>
                            <div class="advice-text">${advice.rainText}</div>
                            <div class="tooltip">${advice.rainTooltip}</div>
                        </div>
                        <div class="slot-item">
                            <div class="advice-icon">${advice.clothIcon}</div>
                            <div class="advice-text">${advice.clothText}</div>
                            <div class="tooltip">${advice.clothTooltip}</div>
                        </div>
                    </div>
                </div>
            `;

            // 2. æ¸²æŸ“ç¨å¾Œé å ± (Hotbar é¢¨æ ¼)
            const scrollContainer = document.getElementById('futureForecasts');
            scrollContainer.innerHTML = '';

            const todayDate = new Date().getDate();

            others.forEach(f => {
                const hour = new Date(f.startTime).getHours();
                // é¡¯ç¤ºæ™‚é–“ï¼Œä¾‹å¦‚ "14:00"
                let timeStr = `${hour}:00`;

                // åˆ¤æ–·æ˜¯å¦è·¨æ—¥
                const fDate = new Date(f.startTime);
                if (fDate.getDate() !== todayDate) {
                    timeStr = "æ˜å¤© " + timeStr;
                }

                scrollContainer.innerHTML += `
                    <div class="hotbar-slot">
                        <div class="mini-time">${timeStr}</div>
                        <div class="mini-icon">${getWeatherIcon(f.weather)}</div>
                        <div class="mini-temp">${f.minTemp}Â°-${f.maxTemp}Â°</div>
                        <div style="font-size:0.7rem; color:#AAA; margin-top:2px;">ğŸ’§${f.rain}%</div>
                    </div>
                `;
            });

            // 3. æ›´æ–°æ™‚é–“
            const now = new Date();
            const month = now.getMonth() + 1;
            const date = now.getDate();
            document.getElementById('updateTime').textContent = `${month}/${date} å·²æ›´æ–°`;
        }

        async function fetchWeather() {
            try {
                // ç­‰å¾… 1.5 ç§’è®“ loading æ¢è·‘å®Œ
                const delayPromise = new Promise(resolve => setTimeout(resolve, 1500));
                const fetchPromise = fetch(API_URL).then(res => res.json());

                const [_, json] = await Promise.all([delayPromise, fetchPromise]);

                if (json.success) {
                    renderWeather(json.data);
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'block';
                } else {
                    throw new Error("API Error");
                }
            } catch (e) {
                console.error(e);
                alert("ç„¡æ³•é€£ç·šè‡³ä¼ºæœå™¨ï¼è«‹æª¢æŸ¥ä½ çš„ç¶²è·¯é€£ç·š");
            }
        }

        document.addEventListener("DOMContentLoaded", fetchWeather);
    </script>
</body>

</html>